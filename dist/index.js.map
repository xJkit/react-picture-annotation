{"version":3,"file":"index.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/Annotation.ts","../src/Shape.ts","../src/Transformer.ts","../src/utils/randomId.ts","../src/annotation/CreatingAnnotationState.ts","../src/annotation/DraggingAnnotationState.ts","../src/annotation/TransfromationState.ts","../src/annotation/MoveCanvasState.ts","../src/annotation/DefaultAnnotationState.ts","../src/DeleteButton.tsx","../src/DefaultInputSection.tsx","../src/ReactPictureAnnotation.tsx"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { IShapeData } from \"Shape\";\n\nexport interface IAnnotation<T = IShapeData> {\n  comment?: string;\n  order?: number;\n  id: string;\n  mark: T;\n}\n\nexport enum ToolState {\n  Normal = 'normal',\n  Drag = 'drag',\n}\n","import { IAnnotation } from \"./Annotation\";\n\nexport const defaultShapeStyle: IShapeStyle = {\n  padding: 5,\n  lineWidth: 2,\n  shadowBlur: 10,\n  fontSize: 12,\n  fontColor: \"#212529\",\n  fontBackground: \"#f8f9fa\",\n  secondaryFontBackground: \"#f8f9fa\",\n  secondaryShapeStrokeStyle: \"#f8f9fa\",\n  secondaryFontColor: \"#212529\",\n  fontFamily:\n    \"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', Helvetica, Arial, sans-serif\",\n  shapeBackground: \"hsla(210, 16%, 93%, 0.2)\",\n  shapeStrokeStyle: \"#f8f9fa\",\n  shapeShadowStyle: \"hsla(210, 9%, 31%, 0.35)\",\n  transformerBackground: \"#5c7cfa\",\n  transformerSize: 10,\n};\n\nexport interface IShapeStyle {\n  padding: number;\n  lineWidth: number;\n  shadowBlur: number;\n  fontSize: number;\n  fontColor: string;\n  fontBackground: string;\n  secondaryFontColor: string;\n  secondaryFontBackground: string;\n  secondaryShapeStrokeStyle: string;\n  fontFamily: string;\n  shapeBackground: string;\n  shapeStrokeStyle: string;\n  shapeShadowStyle: string;\n  transformerBackground: string;\n  transformerSize: number;\n}\n\nexport interface IShapeBase {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport interface IShapeAdjustBase {\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n}\n\nexport interface IShapeData extends IShapeBase {\n  type: string;\n}\n\nexport interface IRectShapeData extends IShapeData {\n  type: \"RECT\";\n}\n\nexport interface IShape {\n  shapeStyle: IShapeStyle;\n  onDragStart: (positionX: number, positionY: number) => void;\n  onDrag: (positionX: number, positionY: number) => void;\n  checkBoundary: (positionX: number, positionY: number) => boolean;\n  paint: (\n    canvas2D: CanvasRenderingContext2D,\n    calculateTruePosition: (shapeData: IShapeBase) => IShapeBase,\n    selected: boolean\n  ) => IShapeBase;\n  getAnnotationData: () => IAnnotation;\n  adjustMark: (adjustBase: IShapeAdjustBase) => void;\n  setComment: (comment: string) => void;\n  equal: (data: IAnnotation) => boolean;\n}\n\nexport class RectShape implements IShape {\n  private readonly annotationData: IAnnotation<IShapeData>;\n\n  private readonly onChangeCallBack: () => void;\n\n  private dragStartOffset: { offsetX: number; offsetY: number };\n\n  public readonly shapeStyle: IShapeStyle;\n\n  constructor(\n    data: IAnnotation<IShapeData>,\n    onChange: () => void,\n    shapeStyle: IShapeStyle = defaultShapeStyle\n  ) {\n    this.annotationData = data;\n    this.onChangeCallBack = onChange;\n    this.shapeStyle = shapeStyle;\n  }\n\n  public onDragStart = (positionX: number, positionY: number) => {\n    const { x, y } = this.annotationData.mark;\n    this.dragStartOffset = {\n      offsetX: positionX - x,\n      offsetY: positionY - y,\n    };\n  };\n\n  public onDrag = (positionX: number, positionY: number) => {\n    this.annotationData.mark.x = positionX - this.dragStartOffset.offsetX;\n    this.annotationData.mark.y = positionY - this.dragStartOffset.offsetY;\n    this.onChangeCallBack();\n  };\n\n  public checkBoundary = (positionX: number, positionY: number) => {\n    const {\n      mark: { x, y, width, height },\n    } = this.annotationData;\n\n    return (\n      ((positionX > x && positionX < x + width) ||\n        (positionX < x && positionX > x + width)) &&\n      ((positionY > y && positionY < y + height) ||\n        (positionY < y && positionY > y + height))\n    );\n  };\n\n  public paint = (\n    canvas2D: CanvasRenderingContext2D,\n    calculateTruePosition: (shapeData: IShapeBase) => IShapeBase,\n    selected: boolean\n  ) => {\n    const { x, y, width, height } = calculateTruePosition(\n      this.annotationData.mark\n    );\n    canvas2D.save();\n\n    const {\n      padding,\n      lineWidth,\n      shadowBlur,\n      fontSize,\n      fontColor,\n      fontBackground,\n      secondaryFontColor,\n      secondaryFontBackground,\n      fontFamily,\n      shapeBackground,\n      shapeStrokeStyle,\n      secondaryShapeStrokeStyle,\n      shapeShadowStyle,\n    } = this.shapeStyle;\n\n    const { comment, order } = this.annotationData;\n    const orderText = typeof order === \"number\" ? order.toString() : \"\";\n\n    canvas2D.shadowBlur = shadowBlur;\n    canvas2D.shadowColor = shapeShadowStyle;\n    canvas2D.strokeStyle = orderText ? shapeStrokeStyle : secondaryShapeStrokeStyle;\n    canvas2D.lineWidth = lineWidth;\n    canvas2D.strokeRect(x, y, width, height);\n    canvas2D.restore();\n    if (selected) {\n      canvas2D.fillStyle = shapeBackground;\n      canvas2D.fillRect(x, y, width, height);\n    } else {\n      const labelText = orderText || comment;\n      if (labelText) {\n        canvas2D.font = `${fontSize}px ${fontFamily}`;\n        const metrics = canvas2D.measureText(labelText);\n        canvas2D.save();\n        canvas2D.fillStyle = orderText\n          ? fontBackground\n          : secondaryFontBackground;\n        canvas2D.fillRect(\n          x,\n          y,\n          metrics.width + padding * 2,\n          fontSize + padding * 2\n        );\n        canvas2D.textBaseline = \"top\";\n        canvas2D.fillStyle = orderText ? fontColor : secondaryFontColor;\n        canvas2D.fillText(labelText, x + padding, y + padding);\n      }\n    }\n    canvas2D.restore();\n\n    return { x, y, width, height };\n  };\n\n  public adjustMark = ({\n    x = this.annotationData.mark.x,\n    y = this.annotationData.mark.y,\n    width = this.annotationData.mark.width,\n    height = this.annotationData.mark.height,\n  }: {\n    x?: number;\n    y?: number;\n    width?: number;\n    height?: number;\n  }) => {\n    this.annotationData.mark.x = x;\n    this.annotationData.mark.y = y;\n    this.annotationData.mark.width = width;\n    this.annotationData.mark.height = height;\n    this.onChangeCallBack();\n  };\n\n  public getAnnotationData = () => {\n    return this.annotationData;\n  };\n\n  public setComment = (comment: string) => {\n    this.annotationData.comment = comment;\n  };\n\n  public equal = (data: IAnnotation) => {\n    return (\n      data.id === this.annotationData.id &&\n      data.comment === this.annotationData.comment &&\n      data.mark.x === this.annotationData.mark.x &&\n      data.mark.y === this.annotationData.mark.y &&\n      data.mark.width === this.annotationData.mark.width &&\n      data.mark.height === this.annotationData.mark.height\n    );\n  };\n}\n","import { IShape, IShapeBase } from \"Shape\";\n\nexport interface ITransformer {\n  checkBoundary: (positionX: number, positionY: number) => boolean;\n  startTransformation: (positionX: number, positionY: number) => void;\n  onTransformation: (positionX: number, positionY: number) => void;\n  paint: (\n    canvas2D: CanvasRenderingContext2D,\n    calculateTruePosition: (shapeData: IShapeBase) => IShapeBase,\n    scale: number\n  ) => void;\n}\n\nexport default class Transformer implements ITransformer {\n  private readonly shape: IShape;\n  private currentNodeCenterIndex: number;\n  private scale: number;\n\n  private get nodeWidth() {\n    return this.shape.shapeStyle.transformerSize / this.scale;\n  }\n\n  constructor(shape: IShape, scale: number) {\n    this.shape = shape;\n    this.scale = scale;\n  }\n\n  public checkBoundary = (positionX: number, positionY: number) => {\n    const currentCenterIndex = this.getCenterIndexByCursor(\n      positionX,\n      positionY\n    );\n    return currentCenterIndex >= 0;\n  };\n\n  public startTransformation = (positionX: number, positionY: number) => {\n    this.currentNodeCenterIndex = this.getCenterIndexByCursor(\n      positionX,\n      positionY\n    );\n  };\n\n  public onTransformation = (positionX: number, positionY: number) => {\n    const currentCentersTable = this.getAllCentersTable();\n    currentCentersTable[this.currentNodeCenterIndex].adjust(\n      positionX,\n      positionY\n    );\n  };\n\n  public paint = (\n    canvas2D: CanvasRenderingContext2D,\n    calculateTruePosition: (shapeData: IShapeBase) => IShapeBase,\n    scale: number\n  ) => {\n    this.scale = scale;\n\n    const allCentersTable = this.getAllCentersTable();\n    canvas2D.save();\n    canvas2D.fillStyle = this.shape.shapeStyle.transformerBackground;\n\n    for (const item of allCentersTable) {\n      const { x, y, width, height } = calculateTruePosition({\n        x: item.x - this.nodeWidth / 2,\n        y: item.y - this.nodeWidth / 2,\n        width: this.nodeWidth,\n        height: this.nodeWidth,\n      });\n      canvas2D.fillRect(x, y, width, height);\n    }\n\n    canvas2D.restore();\n  };\n\n  private getCenterIndexByCursor = (positionX: number, positionY: number) => {\n    const allCentersTable = this.getAllCentersTable();\n    return allCentersTable.findIndex((item) =>\n      this.checkEachRectBoundary(item.x, item.y, positionX, positionY)\n    );\n  };\n\n  private checkEachRectBoundary = (\n    rectCenterX: number,\n    rectCenterY: number,\n    positionX: number,\n    positionY: number\n  ) => {\n    return (\n      Math.abs(positionX - rectCenterX) <= this.nodeWidth / 2 &&\n      Math.abs(positionY - rectCenterY) <= this.nodeWidth / 2\n    );\n  };\n\n  private getAllCentersTable = () => {\n    const { shape } = this;\n    const { x, y, width, height } = shape.getAnnotationData().mark;\n    return [\n      {\n        x,\n        y,\n        adjust: (positionX: number, positionY: number) => {\n          shape.adjustMark({\n            x: positionX,\n            y: positionY,\n            width: width + x - positionX,\n            height: height + y - positionY,\n          });\n        },\n      },\n      {\n        x: x + width / 2,\n        y,\n        adjust: (_: number, positionY: number) => {\n          shape.adjustMark({\n            y: positionY,\n            height: height + y - positionY,\n          });\n        },\n      },\n      {\n        x: x + width,\n        y,\n        adjust: (positionX: number, positionY: number) => {\n          shape.adjustMark({\n            x,\n            y: positionY,\n            width: positionX - x,\n            height: y + height - positionY,\n          });\n        },\n      },\n      {\n        x,\n        y: y + height / 2,\n        adjust: (positionX: number) => {\n          shape.adjustMark({\n            x: positionX,\n            width: width + x - positionX,\n          });\n        },\n      },\n      {\n        x: x + width,\n        y: y + height / 2,\n        adjust: (positionX: number) => {\n          shape.adjustMark({ width: positionX - x });\n        },\n      },\n      {\n        x,\n        y: y + height,\n        adjust: (positionX: number, positionY: number) => {\n          shape.adjustMark({\n            x: positionX,\n            width: width + x - positionX,\n            height: positionY - y,\n          });\n        },\n      },\n      {\n        x: x + width / 2,\n        y: y + height,\n        adjust: (_: number, positionY: number) => {\n          shape.adjustMark({\n            height: positionY - y,\n          });\n        },\n      },\n      {\n        x: x + width,\n        y: y + height,\n        adjust: (positionX: number, positionY: number) => {\n          shape.adjustMark({\n            width: positionX - x,\n            height: positionY - y,\n          });\n        },\n      },\n    ];\n  };\n}\n","export default (len = 6) => {\n  const chars = \"ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678\";\n  const maxPos = chars.length;\n  let id = \"\";\n  for (let i = 0; i < len; i++) {\n    id += chars.charAt(Math.floor(Math.random() * maxPos));\n  }\n  return id;\n};\n","import { ReactPictureAnnotation } from \"index\";\nimport { IAnnotationState } from \"./AnnotationState\";\nimport { DefaultAnnotationState } from \"./DefaultAnnotationState\";\n\nexport default class CreatingAnnotationState implements IAnnotationState {\n  private readonly context: ReactPictureAnnotation;\n  constructor(context: ReactPictureAnnotation) {\n    this.context = context;\n  }\n  public onMouseDown = () => undefined;\n  public onMouseMove = (positionX: number, positionY: number) => {\n    const { shapes } = this.context;\n    if (shapes.length > 0) {\n      const currentShape = shapes[shapes.length - 1];\n      const {\n        mark: { x, y },\n      } = currentShape.getAnnotationData();\n      currentShape.adjustMark({\n        width: positionX - x,\n        height: positionY - y,\n      });\n    }\n  };\n\n  public onMouseUp = () => {\n    const { shapes, onShapeChange, setAnnotationState } = this.context;\n    const data = shapes.pop();\n    if (\n      data &&\n      data.getAnnotationData().mark.width !== 0 &&\n      data.getAnnotationData().mark.height !== 0\n    ) {\n      shapes.push(data);\n    } else {\n      this.context.selectedId = null;\n      onShapeChange();\n    }\n    setAnnotationState(new DefaultAnnotationState(this.context));\n  };\n\n  public onMouseLeave = () => this.onMouseUp();\n}\n","import { ReactPictureAnnotation } from \"index\";\nimport { IAnnotationState } from \"./AnnotationState\";\nimport { DefaultAnnotationState } from \"./DefaultAnnotationState\";\n\nexport default class DraggingAnnotationState implements IAnnotationState {\n  private readonly context: ReactPictureAnnotation;\n  constructor(context: ReactPictureAnnotation) {\n    this.context = context;\n  }\n  public onMouseDown = () => undefined;\n  public onMouseMove = (positionX: number, positionY: number) => {\n    const { shapes } = this.context;\n    const currentShape = shapes[shapes.length - 1];\n    currentShape.onDrag(positionX, positionY);\n  };\n\n  public onMouseUp = () => {\n    const { setAnnotationState } = this.context;\n    setAnnotationState(new DefaultAnnotationState(this.context));\n  };\n\n  public onMouseLeave = () => this.onMouseUp();\n}\n","import { ReactPictureAnnotation } from \"index\";\nimport { IAnnotationState } from \"./AnnotationState\";\nimport { DefaultAnnotationState } from \"./DefaultAnnotationState\";\n\nexport default class TransformationState implements IAnnotationState {\n  private readonly context: ReactPictureAnnotation;\n  constructor(context: ReactPictureAnnotation) {\n    this.context = context;\n  }\n  public onMouseDown = () => undefined;\n  public onMouseMove = (positionX: number, positionY: number) => {\n    const { currentTransformer } = this.context;\n    if (currentTransformer) {\n      currentTransformer.onTransformation(positionX, positionY);\n    }\n  };\n\n  public onMouseUp = () => {\n    const { setAnnotationState } = this.context;\n    setAnnotationState(new DefaultAnnotationState(this.context));\n  };\n\n  public onMouseLeave = () => this.onMouseUp();\n}\n","import { ReactPictureAnnotation } from \"index\";\nimport { IAnnotationState } from \"./AnnotationState\";\nimport { DefaultAnnotationState } from \"./DefaultAnnotationState\";\n\nexport default class DraggingAnnotationState implements IAnnotationState {\n  private readonly context: ReactPictureAnnotation;\n  constructor(context: ReactPictureAnnotation, positionX: number, positionY: number) {\n    this.context = context;\n    this.startX = positionX;\n    this.startY = positionY;\n  }\n  public startX: number\n  public startY: number\n  public onMouseDown = () => undefined;\n  public onMouseMove = (positionX: number, positionY: number) => {\n    document.body.style.cursor = 'move';\n    this.context.onImageMove(positionX - this.startX, positionY - this.startY)\n  };\n\n  public onMouseUp = () => {\n    const { setAnnotationState } = this.context;\n    document.body.style.cursor = 'default';\n    setAnnotationState(new DefaultAnnotationState(this.context));\n  };\n\n  public onMouseLeave = () => this.onMouseUp();\n}\n","import ReactPictureAnnotation from \"../ReactPictureAnnotation\";\nimport { RectShape } from \"../Shape\";\nimport Transformer from \"../Transformer\";\nimport randomId from \"../utils/randomId\";\nimport { ToolState } from '../Annotation';\nimport { IAnnotationState } from \"./AnnotationState\";\nimport CreatingAnnotationState from \"./CreatingAnnotationState\";\nimport DraggingAnnotationState from \"./DraggingAnnotationState\";\nimport TransformationState from \"./TransfromationState\";\nimport MoveCanvasState from './MoveCanvasState';\n\nexport class DefaultAnnotationState implements IAnnotationState {\n  private readonly context: ReactPictureAnnotation;\n  constructor(context: ReactPictureAnnotation) {\n    this.context = context;\n  }\n\n  public onMouseMove = () => undefined;\n  public onMouseUp = () => undefined;\n  public onMouseLeave = () => undefined;\n\n  public onMouseDown = (positionX: number, positionY: number) => {\n    const {\n      shapes,\n      currentTransformer,\n      onShapeChange,\n      setAnnotationState: setState,\n      props,\n    } = this.context;\n\n    // 點選框變形\n    if (\n      currentTransformer &&\n      currentTransformer.checkBoundary(positionX, positionY)\n    ) {\n      currentTransformer.startTransformation(positionX, positionY);\n      setState(new TransformationState(this.context));\n      return;\n    }\n\n    for (let i = shapes.length - 1; i >= 0; i--) {\n      if (shapes[i].checkBoundary(positionX, positionY)) {\n        // 移動圈選框\n        this.context.selectedId = shapes[i].getAnnotationData().id;\n        this.context.currentTransformer = new Transformer(\n          shapes[i],\n          this.context.scaleState.scale\n        );\n        const [selectedShape] = shapes.splice(i, 1);\n        shapes.push(selectedShape);\n        selectedShape.onDragStart(positionX, positionY);\n        onShapeChange();\n        setState(new DraggingAnnotationState(this.context));\n        return;\n      }\n    }\n\n    // [NEW] 移動 Canvas\n    if (props.toolState === ToolState.Drag) {\n      setState(new MoveCanvasState(this.context, positionX, positionY));\n      return;\n    }\n\n    // 新增框框\n    this.context.shapes.push(\n      new RectShape(\n        {\n          id: randomId(),\n          mark: {\n            x: positionX,\n            y: positionY,\n            width: 0,\n            height: 0,\n            type: \"RECT\",\n          },\n        },\n        onShapeChange,\n        this.context.annotationStyle\n      )\n    );\n    setState(new CreatingAnnotationState(this.context));\n  };\n}\n","import React from \"react\";\n\nexport default () => {\n  return (\n    <svg\n      className=\"rp-delete\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g data-name=\"Layer 2\">\n        <g data-name=\"trash-2\">\n          <rect width=\"24\" height=\"24\" opacity=\"0\" />\n          <path d=\"M21 6h-5V4.33A2.42 2.42 0 0 0 13.5 2h-3A2.42 2.42 0 0 0 8 4.33V6H3a1 1 0 0 0 0 2h1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8h1a1 1 0 0 0 0-2zM10 16a1 1 0 0 1-2 0v-4a1 1 0 0 1 2 0zm0-11.67c0-.16.21-.33.5-.33h3c.29 0 .5.17.5.33V6h-4zM16 16a1 1 0 0 1-2 0v-4a1 1 0 0 1 2 0z\" />\n        </g>\n      </g>\n    </svg>\n  );\n};\n","import React from \"react\";\nimport DeleteButton from \"./DeleteButton\";\n\nexport interface IDefaultInputSection {\n  value: string;\n  placeholder?: string;\n  onChange: (value: string) => void;\n  onDelete: () => void;\n}\n\nexport default ({\n  value,\n  onChange,\n  onDelete,\n  placeholder = \"INPUT TAG HERE\",\n}: IDefaultInputSection) => {\n  return (\n    <div className=\"rp-default-input-section\">\n      <input\n        className=\"rp-default-input-section_input\"\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => onChange(e.target.value)}\n      />\n      <a className=\"rp-default-input-section_delete\" onClick={() => onDelete()}>\n        <DeleteButton />\n      </a>\n    </div>\n  );\n};\n","import React, { MouseEventHandler } from 'react';\nimport { IAnnotation, ToolState } from './Annotation';\nimport { IAnnotationState } from './annotation/AnnotationState';\nimport { DefaultAnnotationState } from './annotation/DefaultAnnotationState';\nimport DefaultInputSection from './DefaultInputSection';\n// import DeleteButton from \"./DeleteButton\";\nimport {\n  defaultShapeStyle,\n  IShape,\n  IShapeBase,\n  IShapeStyle,\n  RectShape,\n} from './Shape';\nimport Transformer, { ITransformer } from './Transformer';\n\ninterface IReactPictureAnnotationProps {\n  annotationData?: IAnnotation[];\n  selectedId?: string | null;\n  scrollSpeed: number;\n  marginWithInput: number;\n  onChange: (annotationData: IAnnotation[]) => void;\n  onSelect: (id: string | null) => void;\n  width: number;\n  height: number;\n  image: string;\n  annotationStyle: IShapeStyle;\n  toolState: string;\n  inputElement: (\n    value: string,\n    onChange: (value: string) => void,\n    onDelete: () => void\n  ) => React.ReactElement;\n}\n\ninterface IStageState {\n  scale: number;\n  originX: number;\n  originY: number;\n}\n\nconst defaultState: IStageState = {\n  scale: 1,\n  originX: 0,\n  originY: 0,\n};\n\nexport default class ReactPictureAnnotation extends React.Component<\n  IReactPictureAnnotationProps\n> {\n  public static defaultProps = {\n    marginWithInput: 10,\n    scrollSpeed: 0.0005,\n    toolState: ToolState.Normal,\n    annotationStyle: defaultShapeStyle,\n    inputElement: (\n      value: string,\n      onChange: (value: string) => void,\n      onDelete: () => void\n    ) => (\n      <DefaultInputSection\n        value={value}\n        onChange={onChange}\n        onDelete={onDelete}\n      />\n    ),\n  };\n\n  public state = {\n    inputPosition: {\n      left: 0,\n      top: 0,\n    },\n    showInput: false,\n    inputComment: '',\n  };\n\n  set selectedId(value: string | null) {\n    const { onSelect } = this.props;\n    this.selectedIdTrueValue = value;\n    onSelect(value);\n  }\n\n  get selectedId() {\n    return this.selectedIdTrueValue;\n  }\n\n  get annotationStyle() {\n    return this.props.annotationStyle;\n  }\n  public shapes: IShape[] = [];\n  public scaleState = defaultState;\n  public currentTransformer: ITransformer;\n\n  private currentAnnotationData: IAnnotation[] = [];\n  private selectedIdTrueValue: string | null;\n  private canvasRef = React.createRef<HTMLCanvasElement>();\n  private canvas2D?: CanvasRenderingContext2D | null;\n  private imageCanvasRef = React.createRef<HTMLCanvasElement>();\n  private imageCanvas2D?: CanvasRenderingContext2D | null;\n  private currentImageElement?: HTMLImageElement;\n  private currentAnnotationState: IAnnotationState = new DefaultAnnotationState(\n    this\n  );\n\n  public componentDidMount = () => {\n    const currentCanvas = this.canvasRef.current;\n    const currentImageCanvas = this.imageCanvasRef.current;\n    if (currentCanvas && currentImageCanvas) {\n      this.setCanvasDPI();\n\n      this.canvas2D = currentCanvas.getContext('2d');\n      this.imageCanvas2D = currentImageCanvas.getContext('2d');\n      this.onImageChange();\n    }\n\n    this.syncAnnotationData();\n    this.syncSelectedId();\n  };\n\n  public componentDidUpdate = (preProps: IReactPictureAnnotationProps) => {\n    const { width, height, image } = this.props;\n    if (preProps.width !== width || preProps.height !== height) {\n      this.setCanvasDPI();\n      this.onShapeChange();\n      this.onImageChange();\n    }\n    if (preProps.image !== image) {\n      this.cleanImage();\n      if (this.currentImageElement) {\n        this.currentImageElement.src = image;\n      } else {\n        this.onImageChange();\n      }\n    }\n\n    this.syncAnnotationData();\n    this.syncSelectedId();\n  };\n\n  public calculateMousePosition = (positionX: number, positionY: number) => {\n    const { originX, originY, scale } = this.scaleState;\n    return {\n      positionX: (positionX - originX) / scale,\n      positionY: (positionY - originY) / scale,\n    };\n  };\n\n  public calculateShapePosition = (shapeData: IShapeBase): IShapeBase => {\n    const { originX, originY, scale } = this.scaleState;\n    const { x, y, width, height } = shapeData;\n    return {\n      x: x * scale + originX,\n      y: y * scale + originY,\n      width: width * scale,\n      height: height * scale,\n    };\n  };\n\n  public render() {\n    const { width, height, inputElement } = this.props;\n    const { showInput, inputPosition, inputComment } = this.state;\n    return (\n      <div className=\"rp-stage\">\n        <canvas\n          style={{ width, height }}\n          className=\"rp-image\"\n          ref={this.imageCanvasRef}\n          width={width * 2}\n          height={height * 2}\n        />\n        <canvas\n          className=\"rp-shapes\"\n          style={{ width, height }}\n          ref={this.canvasRef}\n          width={width * 2}\n          height={height * 2}\n          onMouseDown={this.onMouseDown}\n          onMouseMove={this.onMouseMove}\n          onMouseUp={this.onMouseUp}\n          onMouseLeave={this.onMouseLeave}\n          onWheel={this.onWheel}\n        />\n        {showInput && (\n          <div className=\"rp-selected-input\" style={inputPosition}>\n            {inputElement(\n              inputComment,\n              this.onInputCommentChange,\n              this.onDelete\n            )}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  public setAnnotationState = (annotationState: IAnnotationState) => {\n    this.currentAnnotationState = annotationState;\n  };\n\n  public onShapeChange = () => {\n    // 新增框框\n    if (this.canvas2D && this.canvasRef.current) {\n      this.canvas2D.clearRect(\n        0,\n        0,\n        this.canvasRef.current.width,\n        this.canvasRef.current.height\n      );\n\n      let hasSelectedItem = false;\n\n      for (const item of this.shapes) {\n        const isSelected = item.getAnnotationData().id === this.selectedId;\n        const { x, y, height } = item.paint(\n          this.canvas2D,\n          this.calculateShapePosition,\n          isSelected\n        );\n\n        if (isSelected) {\n          if (!this.currentTransformer) {\n            this.currentTransformer = new Transformer(\n              item,\n              this.scaleState.scale\n            );\n          }\n\n          hasSelectedItem = true;\n\n          this.currentTransformer.paint(\n            this.canvas2D,\n            this.calculateShapePosition,\n            this.scaleState.scale\n          );\n\n          this.setState({\n            showInput: true,\n            inputPosition: {\n              left: x,\n              top: y + height + this.props.marginWithInput,\n            },\n            inputComment: item.getAnnotationData().comment || '',\n          });\n        }\n      }\n\n      if (!hasSelectedItem) {\n        this.setState({\n          showInput: false,\n          inputComment: '',\n        });\n      }\n    }\n\n    this.currentAnnotationData = this.shapes.map((item) =>\n      item.getAnnotationData()\n    );\n    const { onChange } = this.props;\n    onChange(this.currentAnnotationData);\n  };\n\n  private syncAnnotationData = () => {\n    const { annotationData } = this.props;\n    if (annotationData) {\n      const refreshShapesWithAnnotationData = () => {\n        this.selectedId = null;\n        this.shapes = annotationData.map(\n          (eachAnnotationData) =>\n            new RectShape(\n              eachAnnotationData,\n              this.onShapeChange,\n              this.annotationStyle\n            )\n        );\n        this.onShapeChange();\n      };\n\n      if (annotationData.length !== this.shapes.length) {\n        refreshShapesWithAnnotationData();\n      } else {\n        for (const annotationDataItem of annotationData) {\n          const targetShape = this.shapes.find(\n            (item) => item.getAnnotationData().id === annotationDataItem.id\n          );\n          if (targetShape && targetShape.equal(annotationDataItem)) {\n            continue;\n          } else {\n            refreshShapesWithAnnotationData();\n            break;\n          }\n        }\n      }\n    }\n  };\n\n  private syncSelectedId = () => {\n    const { selectedId } = this.props;\n\n    if (selectedId && selectedId !== this.selectedId) {\n      this.selectedId = selectedId;\n      this.onShapeChange();\n    }\n  };\n\n  private onDelete = () => {\n    const deleteTarget = this.shapes.findIndex(\n      (shape) => shape.getAnnotationData().id === this.selectedId\n    );\n    if (deleteTarget >= 0) {\n      this.shapes.splice(deleteTarget, 1);\n      this.onShapeChange();\n    }\n  };\n\n  private setCanvasDPI = () => {\n    const currentCanvas = this.canvasRef.current;\n    const currentImageCanvas = this.imageCanvasRef.current;\n    if (currentCanvas && currentImageCanvas) {\n      const currentCanvas2D = currentCanvas.getContext('2d');\n      const currentImageCanvas2D = currentImageCanvas.getContext('2d');\n      if (currentCanvas2D && currentImageCanvas2D) {\n        currentCanvas2D.scale(2, 2);\n        currentImageCanvas2D.scale(2, 2);\n      }\n    }\n  };\n\n  private onInputCommentChange = (comment: string) => {\n    const selectedShapeIndex = this.shapes.findIndex(\n      (item) => item.getAnnotationData().id === this.selectedId\n    );\n    this.shapes[selectedShapeIndex].setComment(comment);\n    this.setState({ inputComment: comment });\n  };\n\n  private cleanImage = () => {\n    if (this.imageCanvas2D && this.imageCanvasRef.current) {\n      this.imageCanvas2D.clearRect(\n        0,\n        0,\n        this.imageCanvasRef.current.width,\n        this.imageCanvasRef.current.height\n      );\n    }\n  };\n\n  private onImageChange = () => {\n    this.cleanImage();\n    if (this.imageCanvas2D && this.imageCanvasRef.current) {\n      if (this.currentImageElement) {\n        const { originX, originY, scale } = this.scaleState;\n        this.imageCanvas2D.drawImage(\n          this.currentImageElement,\n          originX,\n          originY,\n          this.currentImageElement.width * scale,\n          this.currentImageElement.height * scale\n        );\n      } else {\n        const nextImageNode = document.createElement('img');\n        nextImageNode.addEventListener('load', () => {\n          this.currentImageElement = nextImageNode;\n          const { width, height } = nextImageNode;\n          const imageNodeRatio = height / width;\n          const { width: canvasWidth, height: canvasHeight } = this.props;\n          const canvasNodeRatio = canvasHeight / canvasWidth;\n          if (!isNaN(imageNodeRatio) && !isNaN(canvasNodeRatio)) {\n            if (imageNodeRatio < canvasNodeRatio) {\n              const scale = canvasWidth / width;\n              this.scaleState = {\n                originX: 0,\n                originY: (canvasHeight - scale * height) / 2,\n                scale,\n              };\n            } else {\n              const scale = canvasHeight / height;\n              this.scaleState = {\n                originX: (canvasWidth - scale * width) / 2,\n                originY: 0,\n                scale,\n              };\n            }\n          }\n          this.onImageChange();\n          this.onShapeChange();\n        });\n        nextImageNode.alt = '';\n        nextImageNode.src = this.props.image;\n      }\n    }\n  };\n\n  public onImageMove = (dX: number = 0, dY: number = 0) => {\n    this.cleanImage();\n    if (this.imageCanvas2D && this.imageCanvasRef.current) {\n      if (this.currentImageElement) {\n        const { originX, originY, scale } = this.scaleState;\n        this.scaleState.originX = this.scaleState.originX + dX;\n        this.scaleState.originY = this.scaleState.originY + dY;\n        this.imageCanvas2D.drawImage(\n          this.currentImageElement,\n          originX,\n          originY,\n          this.currentImageElement.width * scale,\n          this.currentImageElement.height * scale\n        );\n\n        // this.setState({ imageScale: this.scaleState });\n        requestAnimationFrame(() => {\n          this.onShapeChange();\n          // this.onImageMove();\n        });\n      }\n    }\n  };\n\n  private onMouseDown: MouseEventHandler<HTMLCanvasElement> = (event) => {\n    const { offsetX, offsetY } = event.nativeEvent;\n    const { positionX, positionY } = this.calculateMousePosition(\n      offsetX,\n      offsetY\n    );\n    this.currentAnnotationState.onMouseDown(positionX, positionY);\n  };\n\n  private onMouseMove: MouseEventHandler<HTMLCanvasElement> = (event) => {\n    const { offsetX, offsetY } = event.nativeEvent;\n    const { positionX, positionY } = this.calculateMousePosition(\n      offsetX,\n      offsetY\n    );\n    this.currentAnnotationState.onMouseMove(positionX, positionY);\n  };\n\n  private onMouseUp: MouseEventHandler<HTMLCanvasElement> = () => {\n    this.currentAnnotationState.onMouseUp();\n  };\n\n  private onMouseLeave: MouseEventHandler<HTMLCanvasElement> = () => {\n    this.currentAnnotationState.onMouseLeave();\n  };\n\n  public zoomIn = () => {\n    const { scale: prevScale } = this.scaleState;\n    this.scaleState.scale =\n      this.scaleState.scale > 10 ? 10 : this.scaleState.scale + 0.1;\n    if (this.currentImageElement) {\n      // this.scaleState.originX = this.imageCanvasRef.current.width / 2;\n      const offsetX = this.currentImageElement.width / 2;\n      const offsetY = this.currentImageElement.height / 2;\n\n      const { scale: currentScale, originX, originY } = this.scaleState;\n\n      this.scaleState.originX =\n        offsetX - ((offsetX - originX) / prevScale) * currentScale;\n      this.scaleState.originY =\n        offsetY - ((offsetY - originY) / prevScale) * currentScale;\n    }\n    this.setState({ imageScale: this.scaleState });\n\n    requestAnimationFrame(() => {\n      this.onShapeChange();\n      this.onImageChange();\n    });\n  };\n\n  public zoomOut = () => {\n    const { scale: prevScale } = this.scaleState;\n    this.scaleState.scale =\n      this.scaleState.scale < 0.1 ? 0.1 : this.scaleState.scale - 0.1;\n    if (this.currentImageElement) {\n      // this.scaleState.originX = this.imageCanvasRef.current.width / 2;\n      const offsetX = this.currentImageElement.width / 2;\n      const offsetY = this.currentImageElement.height / 2;\n\n      const { scale: currentScale, originX, originY } = this.scaleState;\n\n      this.scaleState.originX =\n        offsetX - ((offsetX - originX) / prevScale) * currentScale;\n      this.scaleState.originY =\n        offsetY - ((offsetY - originY) / prevScale) * currentScale;\n    }\n    this.setState({ imageScale: this.scaleState });\n\n    requestAnimationFrame(() => {\n      this.onShapeChange();\n      this.onImageChange();\n    });\n  };\n\n  public zoomReset = () => {\n    this.scaleState.scale = 1;\n    this.scaleState.originX = 0;\n    this.scaleState.originY = 0;\n    this.setState({ imageScale: this.scaleState });\n    requestAnimationFrame(() => {\n      this.onShapeChange();\n      this.onImageChange();\n    });\n  };\n\n  private onWheel = (event: React.WheelEvent<HTMLCanvasElement>) => {\n    // https://stackoverflow.com/a/31133823/9071503\n    const { clientHeight, scrollTop, scrollHeight } = event.currentTarget;\n    if (clientHeight + scrollTop + event.deltaY > scrollHeight) {\n      // event.preventDefault();\n      event.currentTarget.scrollTop = scrollHeight;\n    } else if (scrollTop + event.deltaY < 0) {\n      // event.preventDefault();\n      event.currentTarget.scrollTop = 0;\n    }\n\n    const { scale: preScale } = this.scaleState;\n    this.scaleState.scale += event.deltaY * this.props.scrollSpeed;\n    if (this.scaleState.scale > 10) {\n      this.scaleState.scale = 10;\n    }\n    if (this.scaleState.scale < 0.1) {\n      this.scaleState.scale = 0.1;\n    }\n\n    const { originX, originY, scale } = this.scaleState;\n    const { offsetX, offsetY } = event.nativeEvent;\n    this.scaleState.originX =\n      offsetX - ((offsetX - originX) / preScale) * scale;\n    this.scaleState.originY =\n      offsetY - ((offsetY - originY) / preScale) * scale;\n\n    this.setState({ imageScale: this.scaleState });\n\n    requestAnimationFrame(() => {\n      this.onShapeChange();\n      this.onImageChange();\n    });\n  };\n}\n"],"names":["ToolState","defaultShapeStyle","padding","lineWidth","shadowBlur","fontSize","fontColor","fontBackground","secondaryFontBackground","secondaryShapeStrokeStyle","secondaryFontColor","fontFamily","shapeBackground","shapeStrokeStyle","shapeShadowStyle","transformerBackground","transformerSize","RectShape","data","onChange","shapeStyle","annotationData","onChangeCallBack","dragStartOffset","onDragStart","positionX","positionY","mark","x","y","offsetX","offsetY","onDrag","checkBoundary","width","height","paint","canvas2D","calculateTruePosition","selected","save","comment","order","orderText","toString","shadowColor","strokeStyle","strokeRect","restore","fillStyle","fillRect","labelText","font","metrics","measureText","textBaseline","fillText","adjustMark","getAnnotationData","setComment","equal","id","Transformer","shape","scale","currentNodeCenterIndex","currentCenterIndex","getCenterIndexByCursor","startTransformation","onTransformation","currentCentersTable","getAllCentersTable","adjust","allCentersTable","item","nodeWidth","findIndex","checkEachRectBoundary","rectCenterX","rectCenterY","Math","abs","_","len","chars","maxPos","length","i","charAt","floor","random","CreatingAnnotationState","context","onMouseDown","undefined","onMouseMove","shapes","currentShape","onMouseUp","onShapeChange","setAnnotationState","pop","push","selectedId","DefaultAnnotationState","onMouseLeave","DraggingAnnotationState","TransformationState","currentTransformer","startX","startY","document","body","style","cursor","onImageMove","setState","props","scaleState","splice","selectedShape","toolState","Drag","MoveCanvasState","randomId","type","annotationStyle","value","onDelete","placeholder","e","target","defaultState","originX","originY","ReactPictureAnnotation","state","inputPosition","left","top","showInput","inputComment","currentAnnotationData","selectedIdTrueValue","canvasRef","React","createRef","imageCanvasRef","imageCanvas2D","currentImageElement","currentAnnotationState","componentDidMount","currentCanvas","current","currentImageCanvas","setCanvasDPI","getContext","onImageChange","syncAnnotationData","syncSelectedId","componentDidUpdate","preProps","image","cleanImage","src","calculateMousePosition","calculateShapePosition","shapeData","annotationState","clearRect","hasSelectedItem","isSelected","marginWithInput","map","refreshShapesWithAnnotationData","eachAnnotationData","annotationDataItem","targetShape","find","deleteTarget","currentCanvas2D","currentImageCanvas2D","onInputCommentChange","selectedShapeIndex","drawImage","nextImageNode","createElement","addEventListener","imageNodeRatio","canvasWidth","canvasHeight","canvasNodeRatio","isNaN","alt","dX","dY","requestAnimationFrame","event","nativeEvent","zoomIn","prevScale","currentScale","imageScale","zoomOut","zoomReset","onWheel","currentTarget","clientHeight","scrollTop","scrollHeight","deltaY","preScale","scrollSpeed","inputElement","onSelect","Component","defaultProps","Normal"],"mappings":"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"}